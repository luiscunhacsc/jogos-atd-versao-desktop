<!DOCTYPE html>
<html lang="pt-PT">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EthiChat: Simulador Completo</title>
    <style>
        :root {
            --bg-app: #e5e5e5;
            --header-bg: #008069;
            --msg-in: #ffffff;
            --msg-out: #dcf8c6;
            --msg-sys: #ffe4c4;
            --text-main: #303030;
            --text-muted: #667781;
            --accent: #00a884;
            /* Safe area variables */
            --safe-top: env(safe-area-inset-top, 0px);
            --safe-bottom: env(safe-area-inset-bottom, 20px);
        }

        * {
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        /* Reset & Base */
        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            /* Fallback */
            height: 100dvh;
            overflow: hidden;
            /* Previne scroll no body */
            position: fixed;
            /* Fixa o viewport no iOS para evitar bounce */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #d1d7db;
        }

        /* Container Principal */
        .app-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background-color: #efeae2;
            background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png');
            background-repeat: repeat;
            background-blend-mode: soft-light;
            position: relative;
        }

        /* Desktop specific styles */
        @media (min-width: 600px) {
            body {
                position: static;
                /* No desktop, comportamento normal */
                overflow: auto;
                align-items: center;
                justify-content: center;
                display: flex;
            }

            .app-container {
                max-width: 500px;
                height: 100dvh;
                max-height: 900px;
                /* Limite razo√°vel em desktops grandes */
                box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            }
        }

        /* Header */
        header {
            background-color: var(--header-bg);
            padding: 10px 15px;
            padding-top: max(10px, var(--safe-top));
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            z-index: 10;
            flex-shrink: 0;
        }

        .avatar {
            width: 40px;
            height: 40px;
            background: #ccc;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
            font-weight: bold;
        }

        .chat-info h1 {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
        }

        .chat-info p {
            margin: 0;
            font-size: 0.75rem;
            opacity: 0.8;
            margin-top: 2px;
        }

        /* √Årea de Chat */
        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }

        /* Bolhas de Mensagem */
        .msg {
            max-width: 85%;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.95rem;
            line-height: 1.4;
            position: relative;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .msg-in {
            background-color: var(--msg-in);
            align-self: flex-start;
            border-top-left-radius: 0;
        }

        .msg-out {
            background-color: var(--msg-out);
            align-self: flex-end;
            border-top-right-radius: 0;
        }

        .msg-sys {
            background-color: #ffebcd;
            align-self: center;
            font-size: 0.85rem;
            text-align: center;
            border: 1px solid #ffcc80;
            max-width: 90%;
        }

        .msg-meta {
            display: block;
            font-size: 0.65rem;
            color: var(--text-muted);
            text-align: right;
            margin-top: 4px;
        }

        /* √Årea de Input (Op√ß√µes) */
        .input-area {
            background-color: #f0f2f5;
            padding: 15px;
            padding-bottom: max(30px, var(--safe-bottom));
            /* Padding seguro */
            border-top: 1px solid #ddd;
            width: 100%;
            z-index: 20;
            flex-shrink: 0;
            max-height: 80vh;
            /* Mais espa√ßo para op√ß√µes */
            overflow-y: auto;
        }

        .options-grid {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .btn-option {
            background: white;
            border: 1px solid #ddd;
            padding: 12px;
            border-radius: 20px;
            text-align: left;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.2s;
            color: var(--text-main);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            /* Melhorar target de toque */
            min-height: 44px;
            touch-action: manipulation;
        }

        .btn-option:hover {
            background-color: #f5f6f6;
        }

        /* Indicador de Escrita */
        .typing-indicator {
            background: var(--msg-in);
            padding: 10px 15px;
            border-radius: 20px;
            border-bottom-left-radius: 0;
            align-self: flex-start;
            display: none;
            gap: 5px;
            width: fit-content;
            margin-bottom: 10px;
        }

        .dot {
            width: 8px;
            height: 8px;
            background: #b6b6b6;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .dot:nth-child(1) {
            animation-delay: -0.32s;
        }

        .dot:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes bounce {

            0%,
            80%,
            100% {
                transform: scale(0);
            }

            40% {
                transform: scale(1);
            }
        }

        /* Modal Final */
        .modal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 100;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .btn-reset {
            background: var(--accent);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1rem;
            margin-top: 20px;
            cursor: pointer;
            font-weight: bold;
        }

        .progress-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 4px;
            background: #25d366;
            width: 0%;
            transition: width 0.3s;
            z-index: 11;
        }
    </style>
</head>

<body>

    <div class="app-container">
        <div class="progress-bar" id="progress"></div>
        <header>
            <div class="avatar" id="header-avatar" style="background: #00a884;">üõ°Ô∏è</div>
            <div class="chat-info">
                <h1 id="contact-name">EthiChat</h1>
                <p id="contact-status">Online</p>
            </div>
        </header>

        <div class="chat-area" id="chat">
            <div class="msg msg-sys">
                üëã Bem-vindo ao <b>EthiChat</b>.<br>
                Vais receber mensagens com dilemas sobre √âtica (APA/EFPA/OPP) e Multim√©dia (Mayer).<br>
                Escolhe a resposta correta para avan√ßar.
            </div>

            <div class="typing-indicator" id="typing">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
        </div>

        <div class="input-area">
            <div class="options-grid" id="options-box">
                <button class="btn-option" onclick="startGame()">‚ñ∂Ô∏è Iniciar Simula√ß√£o (20 Cen√°rios)</button>
            </div>
        </div>

        <div class="modal" id="end-modal">
            <div style="font-size: 3rem;">üèÖ</div>
            <h1>Simula√ß√£o Conclu√≠da!</h1>
            <p>Navegaste por 20 cen√°rios cr√≠ticos de √©tica e design multim√©dia.</p>
            <div style="margin-top: 10px; font-size: 0.9rem; color: #ddd;">
                Erros cometidos: <span id="error-count">0</span>
            </div>
            <button class="btn-reset" onclick="location.reload()">Jogar Novamente</button>
        </div>
    </div>

    <script>
        // === BANCO DE DADOS: 20 CEN√ÅRIOS (APA, EFPA, OPP, MAYER) ===
        const scenarios = [
            // --- GRUPO 1: √âTICA E TELEPSICOLOGIA (APA/EFPA/OPP) ---
            {
                id: 1,
                sender: "Cliente Joana",
                avatar: "üë©",
                msg: "Ol√° Dr., estou de f√©rias no Brasil por 2 semanas. Podemos manter a nossa videochamada habitual?",
                options: [
                    {
                        text: "Claro, envio o link como habitual.",
                        correct: false,
                        feedback: "‚ùå <b>Risco (APA/EFPA):</b> Pr√°tica Transjurisdicional[cite: 154]. Tens de verificar leis locais e ter plano de emerg√™ncia local."
                    },
                    {
                        text: "N√£o, infelizmente √© proibido exercer psicologia noutra jurisdi√ß√£o.",
                        correct: false,
                        feedback: "‚ùå <b>Impreciso (APA):</b> N√£o √© proibido universalmente, mas exige verifica√ß√£o das leis locais.[cite: 154]."
                    },
                    {
                        text: "Verifico a legisla√ß√£o e o seu contacto de emerg√™ncia local primeiro.",
                        correct: true,
                        feedback: "‚úÖ <b>Correto!</b> Respeito pela jurisdi√ß√£o e seguran√ßa do paciente s√£o priorit√°rios[cite: 154, 168]."
                    }
                ]
            },
            {
                id: 2,
                sender: "Colega Pedro",
                avatar: "üë®‚Äç‚öïÔ∏è",
                msg: "Esta App gratuita de IA transcreve sess√µes e faz resumos. Queres o link?",
                options: [
                    {
                        text: "Manda! Poupa imenso tempo.",
                        correct: false,
                        feedback: "‚ùå <b>Risco (APA/EFPA):</b> Apps gratuitas podem vender dados. √â preciso encripta√ß√£o e acordos de seguran√ßa[cite: 145, 172]."
                    },
                    {
                        text: "S√≥ se tiver contrato de confidencialidade e encripta√ß√£o garantida.",
                        correct: true,
                        feedback: "‚úÖ <b>Correto!</b> A seguran√ßa dos dados exige medidas t√©cnicas robustas[cite: 145, 172]."
                    }
                ]
            },
            {
                id: 3,
                sender: "Cliente Rui",
                avatar: "üë±",
                msg: "O Skype falha. Podemos falar por videochamada do Instagram? √â mais pr√°tico.",
                options: [
                    {
                        text: "OK, ligue-me por l√°.",
                        correct: false,
                        feedback: "‚ùå <b>Risco (EFPA):</b> Misturar redes sociais pessoais compromete limites e seguran√ßa[cite: 174]."
                    },
                    {
                        text: "Para sua seguran√ßa, temos de usar a plataforma encriptada acordada.",
                        correct: true,
                        feedback: "‚úÖ <b>Correto!</b> Devemos usar canais seguros e profissionais[cite: 145]."
                    }
                ]
            },
            {
                id: 4,
                sender: "Diretor Cl√≠nica",
                avatar: "üëî",
                msg: "Vamos p√¥r um Chatbot de IA a fazer triagem de suic√≠dio no site. O que achas?",
                options: [
                    {
                        text: "Perigoso. A IA precisa de supervis√£o humana e pode falhar na empatia.",
                        correct: true,
                        feedback: "‚úÖ <b>Correto (OPP):</b> A IA exige supervis√£o ('human-in-the-loop') em situa√ß√µes de risco[cite: 206, 214]."
                    },
                    {
                        text: "√ìtimo, √© eficiente e funciona 24h.",
                        correct: false,
                        feedback: "‚ùå <b>Risco (OPP):</b> Efici√™ncia n√£o supera a seguran√ßa. Algoritmos podem falhar criticamente[cite: 199]."
                    }
                ]
            },
            {
                id: 5,
                sender: "Colega Ana",
                avatar: "üë©‚Äç‚öïÔ∏è",
                msg: "Vou enviar o PDF do teste WISC √† m√£e para ela aplicar ao filho, enquanto eu vejo no Zoom.",
                options: [
                    {
                        text: "N√£o podes. Isso viola a estandardiza√ß√£o e validade do teste.",
                        correct: true,
                        feedback: "‚úÖ <b>Correto (APA/EFPA):</b> Testes devem ser validados para uso online ou manter a integridade[cite: 150, 184]."
                    },
                    {
                        text: "Boa adapta√ß√£o √†s circunst√¢ncias.",
                        correct: false,
                        feedback: "‚ùå <b>Erro (APA):</b> Alterar a administra√ß√£o compromete a validade dos resultados[cite: 150]."
                    }
                ]
            },
            {
                id: 6,
                sender: "Sistema",
                avatar: "‚ö†Ô∏è",
                msg: "ALERTA: Cliente com idea√ß√£o suicida ativa. A chamada caiu e n√£o atende o telem√≥vel.",
                options: [
                    {
                        text: "Espero que ligue de volta.",
                        correct: false,
                        feedback: "‚ùå <b>Neglig√™ncia (APA):</b> Em risco iminente, √© preciso agir[cite: 152]."
                    },
                    {
                        text: "Contacto a emerg√™ncia local da morada dele (plano pr√©vio).",
                        correct: true,
                        feedback: "‚úÖ <b>Correto!</b> O plano de emerg√™ncia com localiza√ß√£o f√≠sica √© vital[cite: 152]."
                    }
                ]
            },
            {
                id: 7,
                sender: "Cliente Sofia",
                avatar: "üë©",
                msg: "Encontrei o seu Facebook pessoal! Enviei pedido de amizade.",
                options: [
                    {
                        text: "Aceitar para criar alian√ßa.",
                        correct: false,
                        feedback: "‚ùå <b>Viola√ß√£o de Limites (EFPA):</b> Rela√ß√µes duplas nas redes confundem o papel terap√™utico[cite: 166]."
                    },
                    {
                        text: "Explicar que n√£o aceito clientes nas redes pessoais por pol√≠tica profissional.",
                        correct: true,
                        feedback: "‚úÖ <b>Correto!</b> Limites claros protegem a rela√ß√£o profissional[cite: 170]."
                    }
                ]
            },
            {
                id: 8,
                sender: "User 'Shadow'",
                avatar: "üë§",
                msg: "Quero consulta an√≥nima. Pago em crypto, sem c√¢mara, sem nome real.",
                options: [
                    {
                        text: "Recuso. Preciso de verificar a identidade para seguran√ßa e consentimento.",
                        correct: true,
                        feedback: "‚úÖ <b>Correto (EFPA):</b> Verifica√ß√£o de identidade √© crucial para responsabilidade legal e cl√≠nica[cite: 180]."
                    },
                    {
                        text: "Aceito, o importante √© ajudar.",
                        correct: false,
                        feedback: "‚ùå <b>Risco (EFPA):</b> Sem identidade, n√£o podes agir em emerg√™ncia nem garantir consentimento[cite: 180]."
                    }
                ]
            },
            {
                id: 9,
                sender: "Colega Tiago",
                avatar: "üë®",
                msg: "Estou no aeroporto. Posso fazer a sess√£o no Wi-Fi p√∫blico num canto calmo?",
                options: [
                    {
                        text: "Sim, usa fones.",
                        correct: false,
                        feedback: "‚ùå <b>Inseguro (APA):</b> Wi-Fi p√∫blico √© vulner√°vel a hackers e o local n√£o garante privacidade ac√∫stica[cite: 145]."
                    },
                    {
                        text: "N√£o! √â inseguro digitalmente e fisicamente.",
                        correct: true,
                        feedback: "‚úÖ <b>Correto!</b> Privacidade exige rede segura e ambiente controlado[cite: 145]."
                    }
                ]
            },
            {
                id: 10,
                sender: "Diretor RH",
                avatar: "üè¢",
                msg: "A nossa IA de recrutamento rejeitou 90% das mulheres. A empresa diz que o algoritmo √© neutro.",
                options: [
                    {
                        text: "√â vi√©s algor√≠tmico. A IA replicou preconceitos hist√≥ricos.",
                        correct: true,
                        feedback: "‚úÖ <b>Correto (OPP):</b> Sistemas de IA podem perpetuar discrimina√ß√£o se n√£o auditados[cite: 199, 210]."
                    },
                    {
                        text: "A matem√°tica √© neutra.",
                        correct: false,
                        feedback: "‚ùå <b>Erro (OPP):</b> Algoritmos aprendem com dados enviesados do passado (Bias)[cite: 199]."
                    }
                ]
            },
            // --- GRUPO 2: DESIGN MULTIM√âDIA (MAYER) & GEST√ÉO DE DADOS ---
            {
                id: 11,
                sender: "Designer Edu",
                avatar: "üé®",
                msg: "Estou a editar o v√≠deo educativo. Vou p√¥r uma m√∫sica de fundo animada para n√£o ser aborrecido.",
                options: [
                    {
                        text: "Boa ideia, torna o v√≠deo mais cativante.",
                        correct: false,
                        feedback: "‚ùå <b>Viola√ß√£o do Princ√≠pio da Coer√™ncia (Mayer):</b> M√∫sica de fundo √© material estranho que sobrecarrega a aprendizagem[cite: 108]."
                    },
                    {
                        text: "Melhor n√£o. Segundo Mayer, devemos excluir sons irrelevantes.",
                        correct: true,
                        feedback: "‚úÖ <b>Correto!</b> O Princ√≠pio da Coer√™ncia diz para remover ru√≠do e distra√ß√µes[cite: 108]."
                    }
                ]
            },
            {
                id: 12,
                sender: "Formadora Bea",
                avatar: "üë©‚Äçüè´",
                msg: "Nos slides da aula, pus o texto todo que vou dizer. Assim podem ler enquanto me ouvem.",
                options: [
                    {
                        text: "Isso cria redund√¢ncia. Eles v√£o ignorar a tua voz ou o texto.",
                        correct: true,
                        feedback: "‚úÖ <b>Correto!</b> Princ√≠pio da Redund√¢ncia: Texto e narra√ß√£o id√™nticos competem e prejudicam a aprendizagem[cite: 110]."
                    },
                    {
                        text: "Excelente, refor√ßa a mensagem duas vezes.",
                        correct: false,
                        feedback: "‚ùå <b>Erro (Mayer):</b> O c√©rebro sobrecarrega ao tentar processar a mesma info visual e auditiva ao mesmo tempo[cite: 110]."
                    }
                ]
            },
            {
                id: 13,
                sender: "Gestor IT",
                avatar: "üíª",
                msg: "Temos um disco r√≠gido antigo com dados de clientes de 2015. Posso deitar no lixo comum?",
                options: [
                    {
                        text: "Sim, j√° passaram muitos anos.",
                        correct: false,
                        feedback: "‚ùå <b>Viola√ß√£o de Seguran√ßa (APA):</b> Dados devem ser eliminados de forma segura (destrui√ß√£o f√≠sica ou wipe)[cite: 145]."
                    },
                    {
                        text: "N√£o! Temos de garantir a destrui√ß√£o segura dos dados primeiro.",
                        correct: true,
                        feedback: "‚úÖ <b>Correto!</b> O descarte de equipamentos exige garantia de que os dados s√£o irrecuper√°veis[cite: 145]."
                    }
                ]
            },
            {
                id: 14,
                sender: "Estagi√°rio",
                avatar: "üë¶",
                msg: "Estou sem tempo para o relat√≥rio. Pedi ao ChatGPT para escrever a an√°lise cl√≠nica. Ficou √≥timo!",
                options: [
                    {
                        text: "Apaga isso! Inseriste dados do paciente numa IA p√∫blica?",
                        correct: true,
                        feedback: "‚úÖ <b>Correto (OPP):</b> Risco grave de confidencialidade e falta de precis√£o cl√≠nica/supervis√£o[cite: 199, 214]."
                    },
                    {
                        text: "Boa estrat√©gia, desde que leias antes de enviar.",
                        correct: false,
                        feedback: "‚ùå <b>Erro √âtico:</b> Inserir dados cl√≠nicos em IAs p√∫blicas viola a confidencialidade[cite: 199]."
                    }
                ]
            },
            {
                id: 15,
                sender: "Prof. Carlos",
                avatar: "üë¥",
                msg: "Vou gravar a narra√ß√£o dos v√≠deos com aquela voz rob√≥tica do Google. √â mais r√°pido que gravar a minha.",
                options: [
                    {
                        text: "Tenta gravar tu. A voz humana promove melhor aprendizagem.",
                        correct: true,
                        feedback: "‚úÖ <b>Correto!</b> Princ√≠pio da Voz (Mayer): Vozes humanas padr√£o s√£o melhores que vozes de m√°quina[cite: 118]."
                    },
                    {
                        text: "Sem problema, hoje em dia as pessoas habituam-se.",
                        correct: false,
                        feedback: "‚ùå <b>Erro (Mayer):</b> A voz humana cria uma resposta social que melhora o esfor√ßo cognitivo[cite: 118]."
                    }
                ]
            },
            {
                id: 16,
                sender: "Cliente (16 anos)",
                avatar: "üßí",
                msg: "Ol√°, quero marcar consulta online mas n√£o quero que os meus pais saibam.",
                options: [
                    {
                        text: "Vamos marcar. O que √© dito aqui √© confidencial.",
                        correct: false,
                        feedback: "‚ùå <b>Risco Legal/√âtico (EFPA):</b> Menores precisam geralmente de consentimento dos tutores, especialmente online[cite: 180]."
                    },
                    {
                        text: "Como √©s menor, preciso de falar sobre o consentimento dos teus pais primeiro.",
                        correct: true,
                        feedback: "‚úÖ <b>Correto!</b> O consentimento informado com vulner√°veis/menores exige cuidados redobrados[cite: 180]."
                    }
                ]
            },
            {
                id: 17,
                sender: "Designer UI",
                avatar: "üëæ",
                msg: "Para o e-learning, vou usar linguagem formal: 'O sujeito deve clicar aqui'. D√° mais autoridade.",
                options: [
                    {
                        text: "Usa antes 'Tu deves' ou 'Clica aqui'.",
                        correct: true,
                        feedback: "‚úÖ <b>Correto!</b> Princ√≠pio da Personaliza√ß√£o (Mayer): Estilo de conversa melhora a aprendizagem[cite: 117]."
                    },
                    {
                        text: "Concordo, mant√©m o tom acad√©mico.",
                        correct: false,
                        feedback: "‚ùå <b>Erro (Mayer):</b> Linguagem formal distancia o aluno e reduz o processamento ativo[cite: 117]."
                    }
                ]
            },
            {
                id: 18,
                sender: "Colega Marta",
                avatar: "üë©‚Äç‚öïÔ∏è",
                msg: "Tenho um paciente com fobia de voar. Vou usar terapia de Realidade Virtual (VR). Nunca usei, mas aprendo na hora.",
                options: [
                    {
                        text: "For√ßa! √â uma tecnologia inovadora.",
                        correct: false,
                        feedback: "‚ùå <b>Incompet√™ncia (APA):</b> Deves ter treino/supervis√£o antes de usar novas tecnologias com pacientes[cite: 143]."
                    },
                    {
                        text: "Tens forma√ß√£o em VR? Se n√£o, √© eticamente arriscado.",
                        correct: true,
                        feedback: "‚úÖ <b>Correto!</b> A compet√™ncia tecnol√≥gica √© um requisito √©tico fundamental[cite: 143, 158]."
                    }
                ]
            },
            {
                id: 19,
                sender: "Produtor V√≠deo",
                avatar: "üé•",
                msg: "Vou p√¥r a tua cara num quadradinho no canto do v√≠deo durante a explica√ß√£o toda. Fica tipo Twitch!",
                options: [
                    {
                        text: "N√£o vale a pena. A minha cara pode distrair do conte√∫do visual.",
                        correct: true,
                        feedback: "‚úÖ <b>Correto!</b> Princ√≠pio da Imagem (Mayer): A imagem do orador n√£o melhora necessariamente a aprendizagem e pode distrair[cite: 118]."
                    },
                    {
                        text: "Sim! As pessoas gostam de ver quem fala.",
                        correct: false,
                        feedback: "‚ùå <b>Erro (Mayer):</b> Pode causar sobrecarga visual desnecess√°ria se n√£o adicionar valor[cite: 118]."
                    }
                ]
            },
            {
                id: 20,
                sender: "Chefe Empresa",
                avatar: "üè¢",
                msg: "Instalamos c√¢maras com IA para ler as express√µes faciais dos trabalhadores e detetar quem est√° infeliz.",
                options: [
                    {
                        text: "Isso levanta graves quest√µes de privacidade e press√£o laboral.",
                        correct: true,
                        feedback: "‚úÖ <b>Correto (OPP):</b> Monitoriza√ß√£o invasiva por IA pode piorar a sa√∫de psicol√≥gica em vez de ajudar[cite: 201]."
                    },
                    {
                        text: "Inovador! Assim podemos despedir quem anda triste.",
                        correct: false,
                        feedback: "‚ùå <b>Anti-√©tico (OPP):</b> O uso de IA no trabalho deve promover bem-estar, n√£o vigil√¢ncia punitiva[cite: 201]."
                    }
                ]
            }
        ];

        // === L√ìGICA DO JOGO ===
        let currentScenarioIndex = 0;
        let errors = 0;
        const chatBox = document.getElementById('chat');
        const optionsBox = document.getElementById('options-box');
        const typingIndicator = document.getElementById('typing');
        const headerName = document.getElementById('contact-name');
        const headerAvatar = document.getElementById('header-avatar');
        const progressBar = document.getElementById('progress');
        const errorDisplay = document.getElementById('error-count');

        function getTime() {
            const now = new Date();
            return now.getHours() + ':' + (now.getMinutes() < 10 ? '0' : '') + now.getMinutes();
        }

        function addMessage(text, type, metaText = getTime()) {
            const div = document.createElement('div');
            div.className = `msg ${type}`;
            div.innerHTML = `
                ${text}
                <span class="msg-meta">${metaText}</span>
            `;
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function showTyping() {
            typingIndicator.style.display = 'flex';
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function hideTyping() {
            typingIndicator.style.display = 'none';
        }

        function setHeader(name, avatar) {
            headerName.innerText = name;
            headerAvatar.innerText = avatar;
        }

        function updateProgress() {
            const pct = (currentScenarioIndex / scenarios.length) * 100;
            progressBar.style.width = `${pct}%`;
        }

        function startGame() {
            chatBox.innerHTML = ''; // Limpar intro
            optionsBox.innerHTML = '';
            currentScenarioIndex = 0;
            errors = 0;
            updateProgress();

            // Re-adicionar typing indicator que foi limpo
            chatBox.appendChild(typingIndicator);

            loadScenario(0);
        }

        function loadScenario(index) {
            if (index >= scenarios.length) {
                setTimeout(() => {
                    errorDisplay.innerText = errors;
                    document.getElementById('end-modal').style.display = 'flex';
                }, 1000);
                return;
            }

            const sc = scenarios[index];
            updateProgress();

            setHeader(sc.sender, sc.avatar);

            setTimeout(() => {
                showTyping();
                setTimeout(() => {
                    hideTyping();
                    addMessage(sc.msg, 'msg-in');
                    renderOptions(sc.options);
                }, 1200);
            }, 500);
        }

        function renderOptions(options) {
            // Baralhar op√ß√µes para n√£o ser sempre a mesma ordem
            const shuffled = [...options].sort(() => Math.random() - 0.5);

            optionsBox.innerHTML = '';
            shuffled.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'btn-option';
                btn.innerText = opt.text;
                btn.onclick = () => handleChoice(opt);
                optionsBox.appendChild(btn);
            });
        }

        function handleChoice(option) {
            addMessage(option.text, 'msg-out');
            optionsBox.innerHTML = ''; // Limpar bot√µes

            if (option.correct) {
                // Resposta Positiva
                setTimeout(() => {
                    showTyping();
                    setTimeout(() => {
                        hideTyping();
                        addMessage(option.feedback, 'msg-in'); // Feedback positivo tamb√©m √© bom

                        setTimeout(() => {
                            addMessage("<i>(Pr√≥ximo Chat...)</i>", 'msg-sys', 'Sistema');
                            currentScenarioIndex++;
                            loadScenario(currentScenarioIndex);
                        }, 2000);
                    }, 800);
                }, 500);
            } else {
                // Erro
                errors++;
                setTimeout(() => {
                    addMessage(`üëÆ <b>Mentor √âtico:</b> ${option.feedback}`, 'msg-sys', 'Alerta');

                    // Repetir a pergunta
                    setTimeout(() => {
                        addMessage("Tenta outra vez.", 'msg-sys', 'Sistema');
                        // Restaurar bot√µes originais
                        const currentOpts = scenarios[currentScenarioIndex].options;
                        renderOptions(currentOpts);
                    }, 2500);
                }, 800);
            }
        }

    </script>
</body>

</html>